{% extends 'base.html.twig' %}

{# =========================
   PAGE TITLE
   ========================= #}
{% block title %}
    Animal Stock Register
{% endblock %}

{# =========================
   STYLES
   ========================= #}
{% block stylesheets %}
    {{ parent() }}
    <style>
        body {
            font-family: DejaVu Sans, sans-serif;
            font-size: 10px;
            margin: 10px;
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: auto;
            min-width: 1800px;
            border-collapse: collapse;
            table-layout: auto;
        }

        th, td {
            border: 1px solid #000;
            padding: 3px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        th {
            font-weight: bold;
        }

        .text-left {
            text-align: left;
        }

        .category-row {
            font-weight: bold;
            background: #f0f0f0;
        }

        .total-row {
            font-weight: bold;
            background: #e5e5e5;
        }

        /* Freeze first 4 columns */
        th:nth-child(-n+4),
        td:nth-child(-n+4) {
            position: sticky;
            left: 0;
            background: #fff;
            z-index: 2;
        }

        .category-row td,
        .total-row td {
            background: #f0f0f0;
            z-index: 3;
        }
    </style>
{% endblock %}

{# =========================
   MAIN CONTENT
   ========================= #}
{% block body %}

    <form method="get" style="text-align:center; margin-bottom:10px;">
        From:
        <input type="date" name="from_date" value="{{ from_date }}">

        To:
        <input type="date" name="to_date" value="{{ to_date }}">

        <button type="submit">Generate</button>

        <a
                href="{{ path('web_animal_population_print_animals', {
                    from_date: from_date,
                    to_date: to_date
                }) }}"
                target="_blank"
                style="
            margin-left:10px;
            padding:4px 10px;
            border:1px solid #000;
            text-decoration:none;
            color:#000;
            font-size:12px;
        "
        >
            Print
        </a>
    </form>

    <h3 style="text-align:center; margin-bottom:5px;">
        Animal Stock Register
    </h3>

    <p style="text-align:center; margin-top:0;">
        Period: <strong>{{ from_date }}</strong> to <strong>{{ to_date }}</strong>
    </p>

    <div class="table-wrapper">
        <table>
            <thead>
            <tr>
                <th rowspan="3">S. No.</th>
                <th rowspan="3">Animal Name</th>
                <th rowspan="3">Scientific Name</th>
                <th rowspan="3">Schedule</th>

                <th colspan="4">Opening Stock as on {{ from_date }}</th>
                <th colspan="4">Births</th>
                <th colspan="4">Acquisitions</th>
                <th colspan="4">Disposals</th>
                <th colspan="4">Deaths</th>
                <th colspan="4">Closing Stock as on {{ to_date }}</th>
            </tr>

            <tr>
                {% for i in 1..6 %}
                    <th colspan="4"></th>
                {% endfor %}
            </tr>

            <tr>
                {% for i in 1..6 %}
                    <th>M</th>
                    <th>F</th>
                    <th>U</th>
                    <th>T</th>
                {% endfor %}
            </tr>
            </thead>

            <tbody>
            {% for categoryName, category in categories %}
                <tr class="category-row">
                    <td colspan="28" class="text-left">
                        {{ loop.index }}. {{ categoryName }}
                    </td>
                </tr>

                {% if category.rows is not empty %}
                    {% for row in category.rows %}
                        <tr>
                            <td>{{ row.sl }}</td>
                            <td class="text-left">{{ row.name }}</td>
                            <td class="text-left">{{ row.scientific }}</td>
                            <td>{{ row.schedule }}</td>

                            <td>{{ row.opening.m }}</td>
                            <td>{{ row.opening.f }}</td>
                            <td>{{ row.opening.u }}</td>
                            <td>{{ row.opening.t }}</td>

                            <td>{{ row.births.m }}</td>
                            <td>{{ row.births.f }}</td>
                            <td>{{ row.births.u }}</td>
                            <td>{{ row.births.t }}</td>

                            <td>{{ row.acquisitions.m }}</td>
                            <td>{{ row.acquisitions.f }}</td>
                            <td>{{ row.acquisitions.u }}</td>
                            <td>{{ row.acquisitions.t }}</td>

                            <td>{{ row.disposals.m }}</td>
                            <td>{{ row.disposals.f }}</td>
                            <td>{{ row.disposals.u }}</td>
                            <td>{{ row.disposals.t }}</td>

                            <td>{{ row.deaths.m }}</td>
                            <td>{{ row.deaths.f }}</td>
                            <td>{{ row.deaths.u }}</td>
                            <td>{{ row.deaths.t }}</td>

                            <td>{{ row.closing.m }}</td>
                            <td>{{ row.closing.f }}</td>
                            <td>{{ row.closing.u }}</td>
                            <td>{{ row.closing.t }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="28" class="text-left">
                            No {{ categoryName }}
                        </td>
                    </tr>
                {% endif %}

                <tr class="total-row">
                    <td colspan="4" class="text-left">Total {{ categoryName }}</td>

                    <td>{{ category.total.opening.m }}</td>
                    <td>{{ category.total.opening.f }}</td>
                    <td>{{ category.total.opening.u }}</td>
                    <td>{{ category.total.opening.t }}</td>

                    <td>{{ category.total.births.m }}</td>
                    <td>{{ category.total.births.f }}</td>
                    <td>{{ category.total.births.u }}</td>
                    <td>{{ category.total.births.t }}</td>

                    <td>{{ category.total.acquisitions.m }}</td>
                    <td>{{ category.total.acquisitions.f }}</td>
                    <td>{{ category.total.acquisitions.u }}</td>
                    <td>{{ category.total.acquisitions.t }}</td>

                    <td>{{ category.total.disposals.m }}</td>
                    <td>{{ category.total.disposals.f }}</td>
                    <td>{{ category.total.disposals.u }}</td>
                    <td>{{ category.total.disposals.t }}</td>

                    <td>{{ category.total.deaths.m }}</td>
                    <td>{{ category.total.deaths.f }}</td>
                    <td>{{ category.total.deaths.u }}</td>
                    <td>{{ category.total.deaths.t }}</td>

                    <td>{{ category.total.closing.m }}</td>
                    <td>{{ category.total.closing.f }}</td>
                    <td>{{ category.total.closing.u }}</td>
                    <td>{{ category.total.closing.t }}</td>
                </tr>
            {% endfor %}

            <tr class="total-row">
                <td colspan="4" class="text-left">Total Animals</td>

                <td>{{ grand_total.opening.m }}</td>
                <td>{{ grand_total.opening.f }}</td>
                <td>{{ grand_total.opening.u }}</td>
                <td>{{ grand_total.opening.t }}</td>

                <td>{{ grand_total.births.m }}</td>
                <td>{{ grand_total.births.f }}</td>
                <td>{{ grand_total.births.u }}</td>
                <td>{{ grand_total.births.t }}</td>

                <td>{{ grand_total.acquisitions.m }}</td>
                <td>{{ grand_total.acquisitions.f }}</td>
                <td>{{ grand_total.acquisitions.u }}</td>
                <td>{{ grand_total.acquisitions.t }}</td>

                <td>{{ grand_total.disposals.m }}</td>
                <td>{{ grand_total.disposals.f }}</td>
                <td>{{ grand_total.disposals.u }}</td>
                <td>{{ grand_total.disposals.t }}</td>

                <td>{{ grand_total.deaths.m }}</td>
                <td>{{ grand_total.deaths.f }}</td>
                <td>{{ grand_total.deaths.u }}</td>
                <td>{{ grand_total.deaths.t }}</td>

                <td>{{ grand_total.closing.m }}</td>
                <td>{{ grand_total.closing.f }}</td>
                <td>{{ grand_total.closing.u }}</td>
                <td>{{ grand_total.closing.t }}</td>
            </tr>
            </tbody>
        </table>
    </div>

{% endblock %}
